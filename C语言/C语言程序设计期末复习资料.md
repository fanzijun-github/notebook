

> [!NOTE] 说明
> 本复习资料严格依据课程大纲编写，内容力求**严谨、系统、详尽**，适用于基础薄弱的同学查漏补缺。所有知识点均以定义先行、表格归纳、代码示例辅助的方式呈现，便于在 Obsidian 中建立知识链接。

---

## 一、考试形式

| 题型 | 分值 | 考察内容 | 复习重点 |
| :--- | :---: | :--- | :--- |
| **选择题** | 20分 | 基础概念辨析、语法细节、运算符优先级等 | 熟读教材章节小结，掌握基本定义 |
| **程序分析题** | 50分 | 程序填空、执行结果问答、程序改错/改写 | 精做所有例题与上机作业，理解控制流与函数调用 |
| **程序设计题** | 30分 | 综合应用（如数组处理、字符串操作、简单算法） | 动手编写并调试典型题目，掌握函数封装思想 |

---

## 二、C语言开发环境与文件体系（Linux）

在 Linux 环境下，C 程序从源码到可执行文件需经历**预处理 → 编译 → 汇编 → 链接**四个阶段。不同阶段生成不同类型的文件。

### 文件类型与后缀名

| 后缀 | 文件类型 | 作用 | 生成方式 |
| :--- | :--- | :--- | :--- |
| `.c` | 源代码文件（Source File） | 程序员编写的 C 语言代码 | 手动创建 |
| `.h` | 头文件（Header File） | 声明函数、宏、类型等，供 `.c` 文件包含 | 手动创建或系统提供 |
| `.o` | 目标文件（Object File） | 编译后的机器码，未解析外部引用 | `gcc -c file.c` |
| `.a` | 静态库文件（Archive） | 多个 `.o` 文件的集合，用于链接 | `ar -rc libname.a *.o` |
| （无） | 可执行文件（Executable） | 可直接由操作系统加载运行的二进制程序 | `gcc main.c libcs.a -o program` |

> [!IMPORTANT] 注意
> - 在 Linux 中，可执行文件**没有固定后缀**，通常通过 `./<filename>` 执行。
> - `*` 是 shell 通配符，匹配任意字符序列（包括空序列）。

### 典型编译命令流程

```bash
# 1. 编译源文件为目标文件
gcc -c genlib.c strlib.c simpio.c

# 2. 将目标文件打包为静态库（可选，但教学库常用）
ar -rc libcs.a *.o

# 3. 链接主程序与库，生成可执行文件
gcc main.c libcs.a -o myprogram

# 4. 运行程序
./myprogram
```

---

## 三、C程序的基本结构

一个符合 ANSI C 标准的最简程序必须包含 `main` 函数。

### 基本模板

```c
#include <stdio.h>        // 预处理指令：包含标准输入输出头文件

int main(void) {          // 主函数定义，程序入口点
    printf("Hello, World!\n");
    return 0;             // 返回0表示程序正常终止
}
```

### 结构要素详解

| 要素 | 说明 |
| :--- | :--- |
| **`#include`** | 预处理指令，将指定头文件的内容**复制**到当前文件中，使程序能使用其中声明的函数（如 `printf`）。 |
| **注释** | `//` 单行注释；`/* ... */` 多行注释。编译器会完全忽略注释内容。 |
| **`main` 函数** | **每个 C 程序有且仅有一个 `main` 函数**。操作系统启动程序时，从 `main` 的第一条语句开始执行。 |
| **语句** | 执行的基本单位，以分号 `;` 结尾。 |
| **`return` 语句** | 终止函数执行，并向调用者返回一个值。`main` 函数返回 `0` 是良好实践，表示成功。 |

---

## 四、数据类型、常量、变量与表达式

### 1. 基本数据类型

C 语言提供以下内置基本类型：

| 类型关键字 | 名称 | 存储内容 | 典型用途 | 示例 |
| :--- | :--- | :--- | :--- | :--- |
| `int` | 整型 | 整数 | 计数、索引、ID | `int count = 100;` |
| `double` | 双精度浮点型 | 实数（带小数） | 科学计算、金额 | `double pi = 3.14159;` |
| `char` | 字符型 | 单个字符（ASCII码） | 文本处理 | `char initial = 'A';` |
| `bool` | 布尔型 | 逻辑值 `true`/`false` | 条件判断 | `bool is_valid = true;`<br>（需 `#include "genlib.h"`） |

> [!TIP] 补充说明
> - `bool` 类型在标准 C99 中通过 `<stdbool.h>` 提供，但本课程使用教学库 `genlib.h` 定义。
> - `char` 本质是小整数（-128~127 或 0~255），可参与算术运算。

### 2. 常量（Constants）

**定义**：在程序运行期间其值不可被修改的量。

| 常量类型 | 书写形式 | 说明 |
| :--- | :--- | :--- |
| 整型常量 | `123`, `-456`, `0xFF` | 支持十进制、八进制（`0`开头）、十六进制（`0x`开头） |
| 浮点型常量 | `3.14`, `-0.001`, `6.02e23` | 可用科学计数法 |
| 字符常量 | `'A'`, `'\n'`, `'\0'` | 单引号括起，`\` 开头为转义字符 |
| 字符串常量 | `"Hello\nWorld"` | 双引号括起，**自动以 `\0` 结尾** |
| 符号常量 | `#define PI 3.14159` | 预处理宏，在编译前替换 |

### 3. 变量（Variables）

**定义**：具有名称、类型和值的存储单元，其值在运行时可变。

- **声明语法**：`类型 变量名;`
- **初始化**：`类型 变量名 = 初始值;`
- **命名规则**：
  - 由字母、数字、下划线组成，**不能以数字开头**。
  - 区分大小写（`count` 与 `Count` 不同）。
  - 不能是 C 关键字（如 `int`, `if`, `for`）。

### 4. 运算符与表达式

#### 赋值运算符

| 运算符 | 含义 | 等价形式 |
| :--- | :--- | :--- |
| `=` | 简单赋值 | `a = b` |
| `+=` | 加后赋值 | `a = a + b` |
| `-=` | 减后赋值 | `a = a - b` |
| `*=` | 乘后赋值 | `a = a * b` |
| `/=` | 除后赋值 | `a = a / b` |
| `%=` | 取余后赋值 | `a = a % b` |

#### 运算符优先级（部分，从高到低）

| 优先级 | 运算符 | 结合性 | 说明 |
| :--- | :--- | :--- | :--- |
| 1 | `()` | 左→右 | 圆括号（最高优先级） |
| 2 | `!` | 右→左 | 逻辑非 |
| 3 | `* / %` | 左→右 | 乘、除、取模 |
| 4 | `+ -` | 左→右 | 加、减（二元） |
| 5 | `< <= > >=` | 左→右 | 关系比较 |
| 6 | `== !=` | 左→右 | 相等性比较 |
| 7 | `&&` | 左→右 | 逻辑与 |
| 8 | `\|\|` | 左→右 | 逻辑或 |
| 9 | `= += -= ...` | 右→左 | 赋值类（最低优先级） |

> [!WARNING] 建议
> 当表达式复杂或优先级不明确时，**务必使用圆括号 `()` 显式指定计算顺序**，以提高代码可读性和正确性。

### 5. 类型转换

#### 自动转换（隐式）

当不同类型操作数参与运算时，编译器按以下规则自动提升：

```
char → short → int → unsigned int → long → unsigned long → float → double
```

**示例**：
```c
int a = 5;
double b = 3.2;
double c = a + b; // a 被自动转换为 double，结果为 8.2
```

#### 强制转换（显式）

**语法**：`(目标类型) 表达式`

**示例**：
```c
double x = 3.7;
int y = (int) x; // y = 3，小数部分被截断（非四舍五入）
```

> [!CAUTION] 注意
> 强制转换可能导致精度丢失或溢出，应谨慎使用。

---

## 五、控制语句

控制语句决定程序的执行路径。

### 1. 条件语句

#### `if-else` 语句

```c
if (条件表达式) {
    // 条件为真（非0）时执行
} else {
    // 条件为假（0）时执行，可选
}
```

- **嵌套**：`if` 体内可包含另一个 `if`。
- **`else if` 链**：用于多条件分支。
  ```c
  if (score >= 90) grade = 'A';
  else if (score >= 80) grade = 'B';
  else if (score >= 70) grade = 'C';
  else grade = 'F';
  ```

#### `switch` 语句

适用于基于**整型或字符型**表达式的多路分支。

```c
switch (表达式) {
    case 常量1:
        // 语句块1
        break;
    case 常量2:
        // 语句块2
        break;
    ...
    default:
        // 默认分支（可选）
}
```

> [!IMPORTANT] 关键点
> - `case` 标签后必须是**编译时常量**（如字面量、`#define` 宏）。
> - **`break` 语句至关重要**：若省略，程序会“穿透”（fall through）到下一个 `case`，直至遇到 `break` 或 `switch` 结束。

### 2. 循环语句

| 循环类型 | 语法 | 特点 | 适用场景 |
| :--- | :--- | :--- | :--- |
| `for` | `for (init; condition; update) { ... }` | 初始化、条件、更新集中 | 循环次数已知 |
| `while` | `while (condition) { ... }` | 先判断条件，再执行循环体 | 循环次数未知 |
| `do-while` | `do { ... } while (condition);` | 先执行一次循环体，再判断 | 至少执行一次循环体 |

#### `for` 与 `while` 的等价性

任何 `for` 循环均可转换为 `while` 循环：

```c
// for 形式
for (int i = 0; i < n; i++) {
    /* body */
}

// 等价 while 形式
{
    int i = 0;
    while (i < n) {
        /* body */
        i++;
    }
}
```

> [!NOTE] 作用域差异
> `for` 循环中声明的变量（如 `int i`）其作用域仅限于该循环内部（C99标准），而 `while` 中需在外部声明。

---

## 六、函数

**定义**：完成特定任务的独立代码模块，可被多次调用。

### 1. 函数的组成

```c
返回值类型 函数名(参数列表) {
    // 函数体（局部变量声明 + 语句）
    return 表达式; // 若返回类型非 void
}
```

- **函数声明（Prototype）**：`返回值类型 函数名(参数类型列表);`
  - 作用：告知编译器函数的存在，以便在定义前调用。
  - 位置：通常置于 `.h` 文件或 `.c` 文件顶部。
- **函数定义**：包含完整的函数实现。
- **函数调用**：`函数名(实际参数);`

### 2. 参数传递机制

C 语言采用**值传递（Pass by Value）**：
- 调用函数时，**实参的值被复制给形参**。
- 函数内部对形参的修改**不会影响**实参的原始值。

**例外**：通过**指针**可以实现“引用传递”效果（见[[C语言程序设计期末复习资料#八、指针|指针]]章节）。

### 3. 变量的作用域（Scope）

| 作用域类型 | 定义位置 | 生存期 | 可见范围 |
| :--- | :--- | :--- | :--- |
| **局部变量** | 函数内部 | 函数调用开始 → 函数返回结束 | 仅在定义它的函数内可见 |
| **全局变量** | 所有函数外部 | 程序启动 → 程序结束 | 从定义处到文件结束均可见 |

> [!WARNING] 建议
> 尽量避免使用全局变量，因其破坏了函数的封装性，易引发命名冲突和难以调试的副作用。

---

## 七、数组

**定义**：相同类型元素的有序集合，占用连续内存空间。

### 1. 一维数组

#### 声明与初始化

```c
// 声明
类型 数组名[元素个数];

// 初始化
int arr1[5] = {1, 2, 3, 4, 5}; // 完全初始化
int arr2[] = {10, 20, 30};     // 编译器推断大小为3
int arr3[5] = {0};             // 首元素为0，其余自动初始化为0
```

#### 元素访问

- **下标从 0 开始**：`arr[0]` 是第一个元素，`arr[n-1]` 是最后一个。
- **越界访问是未定义行为**：C 语言不检查数组边界，越界可能导致程序崩溃或数据损坏。

#### `sizeof` 运算符

- `sizeof(数组名)` 返回整个数组占用的字节数。
- `sizeof(数组名) / sizeof(数组名[0])` 可计算元素个数（仅在数组作用域内有效）。

### 2. 数组作为函数参数

**关键性质**：当数组名作为实参传递给函数时，**实际上传递的是数组首元素的地址（即指针）**。

```c
// 函数声明
void processArray(int arr[], int size);

// 调用
int data[10] = {0};
processArray(data, 10); // data 被转换为 &data[0]
```

> [!IMPORTANT] 后果
> 1. 函数内对 `arr[i]` 的修改会**直接影响原数组**。
> 2. 函数无法通过 `sizeof(arr)` 获取原数组大小（此时 `arr` 是指针，`sizeof` 返回指针大小），**必须显式传递数组长度**。

---

## 八、指针（基础）

**定义**：指针是一个变量，其值为另一个变量的**内存地址**。

### 1. 基本操作

| 运算符 | 名称 | 作用 | 示例 |
| :--- | :--- | :--- | :--- |
| `&` | 取地址运算符 | 获取变量的内存地址 | `int *p = &x;` |
| `*` | 解引用运算符 | 访问指针所指向地址中的值 | `*p = 10; // 等价于 x = 10;` |

```c
int x = 5;
int *ptr = &x;      // ptr 存储 x 的地址
printf("%d", *ptr); // 输出 5
*ptr = 20;          // 修改 x 的值为 20
```

### 2. 指针与数组

- **数组名是常量指针**：`arr` 等价于 `&arr[0]`。
- **指针算术**：对指针 `p` 执行 `p + i`，结果是指向 `p` 后第 `i` 个同类型元素的地址。
- **等价访问**：`arr[i]` 与 `*(arr + i)` 完全等价。

### 3. 指针用于函数参数（模拟引用传递）

通过传递变量地址，函数可修改主调函数中的变量。

```c
void swap(int *a, int *b) {
    int temp = *a;
    *a = *b;
    *b = temp;
}

int main() {
    int x = 1, y = 2;
    swap(&x, &y); // 传入地址
    // x=2, y=1
}
```

> [!NOTE] 考试范围
> 动态内存分配（`malloc`/`free`）不作要求

---

## 九、字符串

### 1. C 字符串的本质

- **定义**：以空字符 `\0`（ASCII 值为 0）结尾的 `char` 数组。
- **字符串常量**：`"Hello"` 在内存中表示为 `{'H', 'e', 'l', 'l', 'o', '\0'}`。

### 2. 字符 vs 字符串

| | 字符 (`char`) | 字符串 (`string`) |
| :--- | :--- | :--- |
| **表示** | 单引号 `'A'` | 双引号 `"A"` |
| **类型** | `char` | `char *` (或 `char[]`) |
| **内存** | 1 字节 | 至少 2 字节（含 `\0`） |
| **赋值** | `ch = 'A';` | `str = "Hello";` (仅初始化或指针赋值) |

### 3. 字符串库 `strlib.h`（教学库）

该库将字符串抽象为 `string` 类型，提供安全、易用的接口。

#### 核心函数分类表

| 功能类别 | 函数签名 | 功能描述 |
| :--- | :--- | :--- |
| **构造与拼接** | `string Concat(string s1, string s2)` | 拼接两字符串，返回新字符串 |
| | `string CharToString(char ch)` | 将字符转换为单字符字符串 |
| **信息获取** | `int StringLength(string s)` | 返回字符串长度（不含 `\0`） |
| | `char IthChar(string s, int i)` | 安全返回第 `i` 个字符（含边界检查） |
| **子串操作** | `string SubString(string s, int p1, int p2)` | 返回 `[p1, p2]` 闭区间的子串（自动修正越界） |
| **比较** | `bool StringEqual(string s1, string s2)` | 判断两字符串是否相等（区分大小写） |
| | `int StringCompare(string s1, string s2)` | 字典序比较（类似 `strcmp`） |
| **搜索** | `int FindChar(char ch, string text, int start)` | 从 `start` 开始查找字符 `ch` |
| | `int FindString(string str, string text, int start)` | 从 `start` 开始查找子串 `str` |
| **大小写转换** | `string ConvertToLowerCase(string s)` | 返回全小写新字符串 |
| | `string ConvertToUpperCase(string s)` | 返回全大写新字符串 |
| **数值转换** | `string IntegerToString(int n)` | 整数转字符串 |
| | `int StringToInteger(string s)` | 字符串转整数（非法输入报错） |
| | `string RealToString(double d)` | 浮点数转字符串（`%G` 格式） |
| | `double StringToReal(string s)` | 字符串转浮点数（非法输入报错） |

> [!WARNING] 内存管理警告
> `strlib.h` 中所有返回 `string` 的函数（如 `Concat`, `SubString`）均通过 `malloc` 动态分配新内存。对于**短时运行的教学程序**，操作系统会在程序退出时回收内存，通常无需手动释放。但对于**长期运行的程序**，必须自行管理内存以避免泄漏。本课程考试不涉及手动内存释放。

### 4. 标准库 `string.h`（了解即可）

| 函数 | 功能 | 风险提示 |
| :--- | :--- | :--- |
| `strcpy(dest, src)` | 复制字符串 | `dest` 空间不足会导致缓冲区溢出 |
| `strncpy(dest, src, n)` | 复制至多 `n` 字节 | 若 `src` 长度 ≥ `n`，`dest` 可能不以 `\0` 结尾 |
| `strlen(s)` | 返回字符串长度 | 遍历至 `\0`，若无 `\0` 则行为未定义 |
| `strcat(dest, src)` | 追加字符串 | `dest` 空间必须足够容纳结果 |
| `strcmp(s1, s2)` | 字典序比较 | 返回值含义同 `StringCompare` |

---

## 十、其他重要概念

### 1. `#define` 宏

**定义**：预处理指令，用于文本替换。

#### 符号常量
```c
#define MAX_SIZE 100
#define PI 3.14159
```
- **优点**：提高可读性、便于维护（一处修改，处处生效）。
- **注意**：宏名通常全大写，以区别于变量。

### 2. 枚举类型 (`enum`)

**定义**：一组命名的整数常量。

```c
enum Weekday { MON, TUE, WED, THU, FRI, SAT, SUN };
enum Weekday today = WED; // today 的值为 2
```
- 默认从 0 开始递增，可显式赋值：`enum Color { RED=1, GREEN=2, BLUE=4 };`

### 3. 结构体 (`struct`)

**定义**：将多个不同类型的数据项组合成一个复合数据类型。

```c
struct Point {
    double x;
    double y;
};

struct Student {
    string name;
    int id;
    double gpa;
};
```

#### 使用
```c
struct Student s1;
s1.id = 12345;
s1.name = "Alice";
s1.gpa = 3.8;
```

> [!NOTE] 作用
> 结构体是构建复杂数据结构（如链表、树、记录）的基础单元。

---
